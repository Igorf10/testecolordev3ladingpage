/*
 * Obfuscated & Protected by Igor Ferraz dos Santos and <DEV¬≥>
 * CPF: 119.796.287-50
 * Date: 2025-01-11
 * ¬© All Rights Reserved - Farma<Dev¬≥> Project
 * Unauthorized copying, modification, or distribution is strictly prohibited.
 * For licensing: igor.ferraz.trab10@gmail.com  and dev3company@gmail.com
 */
const e="https://script.google.com/macros/s/AKfycbyzYrXTNHDRM1KPLYMLUjDU-sQsXlO1ccTqniZBiRBXXStbCvumCNmfj0RKoihpWeRedw/exec";document.addEventListener("DOMContentLoaded",()=>{const o=document.getElementById("formFidelidade"),n=document.getElementById("btnEnviar"),a=document.getElementById("mensagemSucesso"),t=document.getElementById("mensagemErro"),i=document.getElementById("textoErro");if(!o)return void console.log("‚ùå Formul√°rio n√£o encontrado");console.log("‚úÖ Formul√°rio de fidelidade carregado"),n&&n.setAttribute("type","button"),o.setAttribute("action","javascript:void(0)");const l=o.querySelector('[name="cep"]');function s(e,o){const n=String(e||"").trim();return n?n.length<2?{valido:!1,mensagem:`${o} muito curto`}:{valido:!0}:{valido:!1,mensagem:`${o} √© obrigat√≥rio`}}function r(e,o="Telefone"){const n=e.replace(/\D/g,"");if(!n)return{valido:!1,mensagem:`${o} √© obrigat√≥rio`};if(n.length<10||n.length>11)return{valido:!1,mensagem:`${o} deve ter 10 ou 11 d√≠gitos`};if(!n.startsWith("21"))return{valido:!1,mensagem:`${o} deve ser do Rio de Janeiro (DDD 21)`};if(11===n.length&&"9"!==n[2])return{valido:!1,mensagem:"Celular deve come√ßar com 9 ap√≥s o DDD (ex: 21 9XXXX-XXXX)"};const a=n.slice(2);return/^(\d)\1+$/.test(a)?{valido:!1,mensagem:`${o} inv√°lido (n√∫meros repetidos)`}:{valido:!0}}function c(e){e&&(e.classList.remove("hide"),e.classList.add("active"),setTimeout(()=>{e.classList.add("hide"),setTimeout(()=>{e.classList.remove("active","hide")},400)},5e3))}function d(e){i&&(i.textContent=e),t&&c(t)}async function m(i){i&&(i.preventDefault(),i.stopPropagation(),i.stopImmediatePropagation()),console.log("üì§ Iniciando valida√ß√µes..."),t&&t.classList.remove("active"),a&&a.classList.remove("active");const l=function(e){const o=e.trim();return o?o.length<3?{valido:!1,mensagem:"Nome deve ter pelo menos 3 caracteres"}:o.includes(" ")?o.split(" ").filter(e=>e.length>=2).length<2?{valido:!1,mensagem:"Informe nome e sobrenome completos"}:{valido:!0}:{valido:!1,mensagem:"Por favor, informe nome e sobrenome (ex: Jo√£o Silva)"}:{valido:!1,mensagem:"Nome completo √© obrigat√≥rio"}}(o.nomeCompleto?.value||"");if(!l.valido)return console.log("‚ùå Nome inv√°lido"),d(l.mensagem),!1;console.log("‚úÖ Nome v√°lido");const m=o.email?.value||"",g=function(e){const o=e.trim().toLowerCase();if(!o)return{valido:!1,mensagem:"E-mail √© obrigat√≥rio"};if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o))return{valido:!1,mensagem:"Formato de e-mail inv√°lido (ex: seuemail@gmail.com)"};const n={"gmial.com":"gmail.com","gmai.com":"gmail.com","gmail.con":"gmail.com","hotmial.com":"hotmail.com","outlok.com":"outlook.com","yahou.com":"yahoo.com"},a=o.split("@")[1];return n[a]?{valido:!1,mensagem:`Voc√™ quis dizer @${n[a]}?`}:{valido:!0,valor:o}}(m);if(!g.valido)return console.log("‚ùå Email inv√°lido"),d(g.mensagem),!1;console.log("‚úÖ Email v√°lido");if(m!==(o.confirmeEmail?.value||""))return console.log("‚ùå Emails n√£o coincidem"),d("Os e-mails n√£o coincidem"),!1;console.log("‚úÖ Email confirmado");const v=function(e){if(!e)return{valido:!1,mensagem:"Data de nascimento √© obrigat√≥ria"};const o=new Date(e),n=new Date;if(isNaN(o.getTime()))return{valido:!1,mensagem:"Data de nascimento inv√°lida"};let a=n.getFullYear()-o.getFullYear();const t=n.getMonth()-o.getMonth();return(t<0||0===t&&n.getDate()<o.getDate())&&a--,a<18?{valido:!1,mensagem:"√â necess√°rio ser maior de 18 anos"}:a>120?{valido:!1,mensagem:"Data de nascimento inv√°lida"}:{valido:!0}}(o.dataNascimento?.value||"");if(!v.valido)return console.log("‚ùå Data de nascimento inv√°lida"),d(v.mensagem),!1;console.log("‚úÖ Data de nascimento v√°lida");const u=function(e){const o=e.replace(/\D/g,"");if(!o)return{valido:!1,mensagem:"CPF √© obrigat√≥rio"};if(11!==o.length)return{valido:!1,mensagem:"CPF deve ter 11 d√≠gitos"};if(/^(\d)\1+$/.test(o))return{valido:!1,mensagem:"CPF inv√°lido (n√∫meros repetidos)"};let n,a=0;for(let e=1;e<=9;e++)a+=parseInt(o.substring(e-1,e))*(11-e);if(n=10*a%11,10!==n&&11!==n||(n=0),n!==parseInt(o.substring(9,10)))return{valido:!1,mensagem:"CPF inv√°lido"};a=0;for(let e=1;e<=10;e++)a+=parseInt(o.substring(e-1,e))*(12-e);return n=10*a%11,10!==n&&11!==n||(n=0),n!==parseInt(o.substring(10,11))?{valido:!1,mensagem:"CPF inv√°lido"}:{valido:!0}}(o.cpf?.value||"");if(!u.valido)return console.log("‚ùå CPF inv√°lido"),d(u.mensagem),!1;console.log("‚úÖ CPF v√°lido");if(!(o.sexo?.value||""))return console.log("‚ùå Sexo n√£o selecionado"),d("Selecione o sexo"),!1;console.log("‚úÖ Sexo selecionado");if(!(o.estadoCivil?.value||""))return console.log("‚ùå Estado civil n√£o selecionado"),d("Selecione o estado civil"),!1;console.log("‚úÖ Estado civil selecionado");const f=function(e){const o=e.replace(/\D/g,"");return o?8!==o.length?{valido:!1,mensagem:"CEP deve ter 8 d√≠gitos"}:{valido:!0}:{valido:!1,mensagem:"CEP √© obrigat√≥rio"}}(o.cep?.value||"");if(!f.valido)return console.log("‚ùå CEP inv√°lido"),d(f.mensagem),!1;console.log("‚úÖ CEP v√°lido");const p=s(o.endereco?.value||"","Endere√ßo");if(!p.valido)return console.log("‚ùå Endere√ßo inv√°lido"),d(p.mensagem),!1;console.log("‚úÖ Endere√ßo v√°lido");const E=s(o.numero?.value||"","N√∫mero");if(!E.valido)return console.log("‚ùå N√∫mero inv√°lido"),d(E.mensagem),!1;console.log("‚úÖ N√∫mero v√°lido");const h=s(o.bairro?.value||"","Bairro");if(!h.valido)return console.log("‚ùå Bairro inv√°lido"),d(h.mensagem),!1;console.log("‚úÖ Bairro v√°lido");const C=s(o.cidade?.value||"","Cidade");if(!C.valido)return console.log("‚ùå Cidade inv√°lida"),d(C.mensagem),!1;console.log("‚úÖ Cidade v√°lida");const b=o.uf?.value||"";if(!b||2!==b.length)return console.log("‚ùå UF inv√°lido"),d("Selecione o estado (UF)"),!1;console.log("‚úÖ UF v√°lido");const D=r(o.telefone?.value||"","Telefone");if(!D.valido)return console.log("‚ùå Telefone inv√°lido"),d(D.mensagem),!1;console.log("‚úÖ Telefone v√°lido");const y=r(o.celular?.value||"","Celular");if(!y.valido)return console.log("‚ùå Celular inv√°lido"),d(y.mensagem),!1;console.log("‚úÖ Celular v√°lido"),console.log("‚úÖ‚úÖ‚úÖ TODAS AS VALIDA√á√ïES PASSARAM! ‚úÖ‚úÖ‚úÖ"),n&&(n.disabled=!0,n.textContent="‚è≥ Enviando...");const P=new FormData(o),S={};for(let[e,o]of P.entries())S[e]=o;S.timestamp=(new Date).toLocaleString("pt-BR"),S.action="fidelidade",console.log("üì¶ Enviando dados:",S);try{const n=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S),redirect:"follow"});let t;try{t=await n.json(),console.log("‚úÖ Resposta:",t)}catch{t={status:"success"}}"success"===t.status?(console.log("üéâ Cadastro realizado com sucesso!"),a&&c(a),o.reset()):"duplicate"===t.status?d(t.message||"Este e-mail j√° est√° cadastrado!"):d(t.message||"Erro ao enviar.")}catch(n){console.error("‚ùå Erro:",n);try{await fetch(e,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)}),a&&c(a),o.reset()}catch{d("Erro ao enviar. Tente novamente.")}}finally{n&&(n.disabled=!1,n.textContent="üéÅ Solicitar meu cart√£o")}return!1}l&&l.addEventListener("blur",async()=>{const e=l.value.replace(/\D/g,"");if(8===e.length)try{console.log("üîç Buscando CEP:",e);const n=await fetch(`https://viacep.com.br/ws/${e}/json/`),a=await n.json();a.erro?d("CEP n√£o encontrado. Verifique e tente novamente."):(console.log("‚úÖ CEP encontrado"),o.endereco&&(o.endereco.value=a.logradouro||""),o.bairro&&(o.bairro.value=a.bairro||""),o.cidade&&(o.cidade.value=a.localidade||""),o.uf&&(o.uf.value=a.uf||""))}catch(e){console.error("‚ùå Erro ao buscar CEP:",e)}}),o.addEventListener("submit",m,!0),n&&n.addEventListener("click",m,!0),console.log("‚úÖ fidelidade.js carregado com valida√ß√µes completas")});